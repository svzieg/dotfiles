# Maildir
set folder           = "~/mail"
set header_cache     = ~/.mutt/cache/headers
set message_cachedir = ~/.mutt/cache/bodies
set alias_file=~/mail/contacts

# {{{ Account settings
# folder-hook "+Gmx/.*" source ~/.mutt/gmx
# folder-hook "+Gmail/.*" source ~/.mutt/gmail
# folder-hook "+Photography/.*" source ~/.mutt/photography
#folder-hook "+Gmx/.*" source ~/.mutt/gmx
source ~/mail/notmuch-mailboxes
source ~/mail/mailboxes

source ~/mail/contacts


# Mailinglists
alternates "ziggo1879@gmail.com|sven.ziegler@svenziegler.photography|sven.ziegler@scheer-group.com"
# subscribe  coderdojo-cgn-planung colognerb


# unfortunately these don't have access to info like subjects or senders
set new_mail_command="dunstify 'New email' '%n new message(s)' &"

alias f__1 Sven Ziegler <svzieg@gmx.de>
alias f__2 Sven Ziegler <sven.ziegler@scheer-group.com>
alias f__3 Sven Ziegler <sven.ziegler@svenziegler.photography>
alias f__4 Sven Ziegler <ziggo1879@gmail.com>
macro compose <esc>f "<edit-from><kill-line>f__<tab><search>sven.ziegler@scheer-group.com<enter>"

#set from=$MUTT_SENDER
send-hook  '~f .*svzieg@gmx.de.*'                         'source "~/.mutt/gmx"'
send2-hook '~f .*svzieg@gmx.de.*'                         'source "~/.mutt/gmx"'

send-hook "%C Familie "                                   'source "~/.mutt/gmx"'

send-hook  '~f .*ziggo1879@gmail.com.*'                   'source "~/.mutt/gmail"'
send2-hook '~f .*ziggo1879@gmail.com.*'                   'source "~/.mutt/gmail"'

send-hook  '~f .*sven.ziegler@scheer-group.com.*'         'source "~/.mutt/work"'
send2-hook '~f .*sven.ziegler@scheer-group.com.*'         'source "~/.mutt/work"'
send-hook '%C Scheer'                           'source "~/.mutt/work"'
send-hook '%C Egetrans'                           'source "~/.mutt/work"'
send-hook '%C Schaeffler'                           'source "~/.mutt/work"'

send-hook  '~f .*sven.ziegler@svenziegler.photography.*'    'source "~/.mutt/photography"'
send2-hook '~f .*sven.ziegler@svenziegler.photography.*'    'source "~/.mutt/photography"'

# }}}

# Fetch mail shortcut
#bind index G imap-fetch-mail

# IMAP and INBOX (this should map to any existing IMAP folders)
mailboxes inbox 
### BEGIN NOTMUCH-MUTT SETTINGS
macro index,pager \cb " unset pipe_decodeurlview" "get URLs"


macro index A "<modify-labels>+archive -unread -inbox\\n" "Archive message"
#macro index d "<modify-labels>+trash -unread -inbox\\n" "Delete message"
macro index c "<change-vfolder>?" "Change to vfolder overview"
macro index \\\\ "<vfolder-from-query>" "Search mailbox"

# {{{ Mutt Behavior
#

# Mutt Behaviour
set move              = no
set sort              = 'threads'
set sort_aux          = 'reverse-last-date-received'
set sort_re           = yes
set pager_stop        = yes
set pager_index_lines = 6
set quit              = ask-yes
set fast_reply        = yes
set include           = yes
set reverse_name      = yes

# autoview settings, show HTML if no Text is available
auto_view text/html
auto_view text/calendar
alternative_order text/enriched text/plain text/html text/*
## Make quick html view macro
bind index,pager V  noop        ## Unbinds V from version
macro index,pager V "<view-attachments><search>html<enter><view-mailcap><exit>"

# VIM-Like Movement in Index
bind index g noop
bind index gg first-entry
bind index G  last-entry
bind index,pager F  flag-message
bind index,pager R  group-reply

# Headers
ignore "Authentication-Results:"
ignore "DomainKey-Signature:"
ignore "DKIM-Signature:"
ignore "X-Flags:"
hdr_order "Date From To Cc"

#set editor
set editor="nvim"

set xterm_set_titles  = yes
set sidebar_visible   = no

# Den Absender möchte ich *fett* dargestellt haben
color header     brightblack   default  "^(from|subject):"
# Und E-Mail Adressen im Body bitte cyanfarben
color body       cyan          default  "[-a-z_0-9.+]+@[-a-z_0-9.]+"

# Und ab hier die Farben der E-Mail Liste:
uncolor index *
color index      white         default  ~Q # Beantwortete Nachrichten
color index      green         default  ~F # Markierte Nachrichten
color index      red           default  ~N # Neue Nachrichten
color index      brightred     default  ~O # Ungelesene Nachrichten
color index      magenta       default  ~T # Getaggte Nachrichten
color index      yellow        default  ~D # Gelöschte Nachrichten

#GPG
set pgp_use_gpg_agent = yes
set pgp_timeout       = 3600
set pgp_autosign      = no
set crypt_use_gpgme   = yes

# SMIME
set crypt_autosign           = no
set crypt_replyencrypt       = no
set crypt_replysign          = no
set crypt_replysignencrypted = no

set smime_ca_location  = "/etc/ssl/certs/ca-certificates.crt"
set smime_certificates = "~/.smime/certificates"
set smime_keys         = "~/.smime/keys"


# SPAM
spam "X-DCC-.*-Metrics:.*(....)=many"         "90+/DCC-%1"
spam "X-Spam-Status: Yes"                     "90+/SA"
spam "X-PerlMX-Spam: .*Probability=([0-9]+)%" "%1/PM"
set spam_separator=", "


#
# }}}


# {{{ Macros
#
macro index tt "<modify-labels>!todo\n" "Toggle tag todo"
#
# }}}



# --------------------------------------------------------------------------
# VARIABLES - shown with their default values
# --------------------------------------------------------------------------
# This variable specifies notmuch query limit. 
set nm_db_limit = 0 
# This variable specifies the default Notmuch database in format:
# notmuch://<absolute path> 
set nm_default_uri = "notmuch:///home/svzieg/mail" 
# The messages tagged with these tags are excluded and not loaded
# from notmuch DB to NeoMutt unless specified explicitly. 
set nm_exclude_tags = "" 
# This option specifies timeout for Notmuch database. Default is 5 seconds.
set nm_open_timeout = 5 
# This variable specifies notmuch query type, supported types: 'threads' and
# 'messages'. 
set nm_query_type = messages # Add messages stored to the NeoMutt record (see $record in the NeoMutt docs) also to notmuch DB. If you reply to an email then the new email inherits tags from the original email.
set nm_record = yes # Tags that should be removed or added to the to the messages stored in the NeoMutt record.

# example:
set record = "~/sent-mails"
# set nm_record = yes
set nm_record_tags = "-inbox,archive,me"
set nm_record_tags = "" # This variable specifies notmuch tag which is used for unread messages. set nm_unread_tag = unread # This variable allows you to customize the file browser display for virtual
# folders to your personal taste.
# %C   current folder number
# %f   folder name (description)
# %m   number of messages in the mailbox *
# %n   number of unread messages in the mailbox *
# %N   N if mailbox has new mail, blank otherwise
# %>X  right justify the rest of the string and pad with character ``X''
# %|X  pad to the end of the line with character ``X''
# %*X  soft-fill with character ``X'' as pad
set vfolder_format = "%6n(%6N) %f" # When set, NeoMutt will use the first virtual mailbox (see virtual-mailboxes)
# as a spoolfile. 
set virtual_spoolfile = yes # setup time window preferences
# first setup the duration, and then the time unit of that duration
# when set to 0 (the default) the search window feature is disable
set nm_query_window_duration=52
set nm_query_window_timebase="week" 
# use very high $read_inc to speed up reading hcache'd maildirs
folder-hook . 'set read_inc=1000'
folder-hook . 'set header_cache=/tmp/cache'
# or "hour", "day", "week", "month", "year" 
# --------------------------------------------------------------------------
# FUNCTIONS - shown with an example mapping
# --------------------------------------------------------------------------
# open a different virtual folder 
bind index,pager X change-vfolder 
# read entire thread of the current message 
bind index,pager + entire-thread 
# generate virtual folder from query 
bind index,pager \eX vfolder-from-query 
# generate virtual folder from query with time window 
bind index < vfolder-window-backward 
bind index > vfolder-window-forward 
# toggle between mailboxes and virtual mailboxes 
# bind index,pager ??? sidebar-toggle-virtual 
# -------------------------------------------------------------------------- 
# COMMANDS - shown with an example 
# -------------------------------------------------------------------------- 
# virtual-mailboxes description notmuch-URI { description notmuch-URI ...} 
# virtual-mailboxes "Climbing" "notmuch://?query=climbing" 
# unvirtual-mailboxes { * | mailbox ...} 
# 
# --------------------------------------------------------------------------
# vim: syntax=neomuttrc
#
#


# Example NeoMutt config file for the custom tags feature.

# --------------------------------------------------------------------------
# FUNCTIONS - shown with an example mapping
# --------------------------------------------------------------------------
# modify (notmuch/imap) tags
bind index,pager \` modify-labels
# modify (notmuch/imap) tag non-interactively.
#bind index,pager tt "<modify-labels>!todo\n" "Toggle the 'todo' tag"
# modify labels and then hide message
# bind index,pager ??? modify-labels-then-hide
# --------------------------------------------------------------------------
# COMMANDS - shown with an example
# --------------------------------------------------------------------------
# Replace some tags with icons
 tag-transforms tag transformed-string { tag transformed-string ...}
 tag-transforms "inbox"   ""   \
                "unread"  "u"   \
                "replied" " "  \
                "sent"    "s "  \
                "important"    ""  \
                "todo"    ""   \
                "deleted" "" \
                "invites" ""

# The formats must start with 'G' and the entire sequence is case sensitive.
 tag-formats tag format-string { tag format-string ...}
 tag-formats "inbox"   "GI" \
              "unread"  "GU" \
              "replied" "GR" \
              "sent"    "GS" \
              "important"    "GF" \
              "todo"    "Gt" \
              "deleted" "GD" \
              "invites" "Gi"

# Now instead of using '%g' or '%J' in your $index_format, which lists all tags
# in a non-deterministic order, you can something like the following which puts
# a transformed tag name in a specific spot on the index line:
set index_format='%4C %S %[%d.%m.%y] %-18.18n %?GF?%GF& ? %?Gt?%Gt& ? %?GU?%GU& ? %?GR?%GR& ? %?GI?%GI& ? %s'

# The %G formatting sequence may display all tags including tags hidden by
# nm_hidden_tags.
#
# --------------------------------------------------------------------------
# COLORS - some unpleasant examples are given
# --------------------------------------------------------------------------
# These symbols are added to the index-color feature:
# an individual message tag, %G, uses tag name
# this symbol uses a pattern
color index_tag red black "important"
# the transformed message tags, %g
# this symbol does not use a pattern
# color index_tags green default
# --------------------------------------------------------------------------
# vim: syntax=neomuttrc
#



# Example NeoMutt config file for the attach-headers-color feature.

# Color if the attachment is autoviewed
color   attach_headers     brightgreen     default    "Autoview"
# Color only the brackets around the headers
color   attach_headers     brightyellow    default    "^\\[--"
color   attach_headers     brightyellow    default    "--]$"
# Color the mime type and the size
color   attach_headers     green           default    "Type: [a-z]+/[a-z0-9\-]+"
color   attach_headers     green           default    "Size: [0-9\.]+[KM]"
# Color GPGME signature checks
color   attach_headers     brightgreen     default    "Good signature from.*"
color   attach_headers     brightred       default    "Bad signature from.*"
color   attach_headers     brightred       default    "BAD signature from.*"
color   attach_headers     brightred       default    "Note: This key has expired!"
color   attach_headers     brightmagenta   default    "Problem signature from.*"
color   attach_headers     brightmagenta   default    "WARNING: This key is not certified with a trusted signature!"
color   attach_headers     brightmagenta   default    "         There is no indication that the signature belongs to the owner."
color   attach_headers     brightmagenta   default    "can't handle these multiple signatures"
color   attach_headers     brightmagenta   default    "signature verification suppressed"
color   attach_headers     brightmagenta   default    "invalid node with packet of type"

# Color the unread messages
color index brightblue black "new"



# Make sure that there are no spaces at the beginning of the line
macro index,pager <F8> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<pipe-message>notmuchtask --debug find-or-create-task<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
"notmuchtask: assign mail to a task"
